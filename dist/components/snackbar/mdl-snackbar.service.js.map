{"version":3,"file":"mdl-snackbar.service.js","sourceRoot":"","sources":["../../../src/lib/components/snackbar/mdl-snackbar.service.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  Component,\n  Injectable,\n  ComponentRef,\n  ComponentFactoryResolver,\n  NgModule,\n  ViewEncapsulation,\n  ModuleWithProviders, ComponentFactory\n} from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MdlDialogOutletService } from '../dialog-outlet/mdl-dialog-outlet.service';\nimport { MdlDialogOutletModule } from '../dialog-outlet/index';\nimport { Observable } from 'rxjs';\nimport { Subject } from 'rxjs';\n\n\nconst ANIMATION_TIME = 250;\n\n@Component({\n  selector: 'mdl-snackbar-component',\n  template: `\n    <div id=\"demo-toast-example\" class=\" mdl-snackbar\" [ngClass]=\"{'mdl-snackbar--active': showIt }\">\n      <div class=\"mdl-snackbar__text\">{{message}}</div>\n      <button *ngIf=\"onAction\" class=\"mdl-snackbar__action\" type=\"button\" (click)=\"onClick()\" >{{actionText}}</button>\n    </div>\n  `,\n  encapsulation: ViewEncapsulation.None\n})\nexport class MdlSnackbarComponent {\n  public message: string;\n  public actionText: string;\n  public showIt = false;\n  public onAction: () => void;\n\n  constructor(){}\n\n  public onClick() {\n    this.onAction();\n  }\n\n  public isActive() {\n    return this.showIt;\n  }\n\n  public show(): Observable<void> {\n    let result: Subject<any> = new Subject();\n    // wait unit the dom is in place - then showIt will change the css class\n    setTimeout(() => {\n      this.showIt = true;\n      // fire after the view animation is done\n      setTimeout(() => {\n        result.next(null);\n        result.complete();\n      }, ANIMATION_TIME);\n    }, ANIMATION_TIME);\n\n\n    return result.asObservable();\n  }\n\n  public hide(): Observable<void> {\n    this.showIt = false;\n\n    let result: Subject<any> = new Subject();\n\n    // fire after the view animation is done\n    setTimeout(() => {\n      result.next(null);\n      result.complete();\n    }, ANIMATION_TIME);\n\n\n    return result.asObservable();\n  }\n}\n\nexport interface IMdlSnackbarMessage {\n  message: string;\n  timeout?: number;\n  closeAfterTimeout?: boolean;\n  action?: {\n    handler: () => void;\n    text: string;\n  };\n}\n\n@Injectable()\nexport class MdlSnackbarService {\n\n  private cFactory: ComponentFactory<any>;\n  private previousSnack: {component: MdlSnackbarComponent, cRef: ComponentRef<any>};\n\n  constructor(\n    private componentFactoryResolver: ComponentFactoryResolver,\n    private dialogOutletService: MdlDialogOutletService) {\n    this.cFactory  = this.componentFactoryResolver.resolveComponentFactory(MdlSnackbarComponent);\n  }\n\n\n  public showToast(message: string, timeout?: number): Observable<MdlSnackbarComponent> {\n    return this.showSnackbar({\n      message: message,\n      timeout: timeout\n    });\n  }\n\n  public showSnackbar(snackbarMessage: IMdlSnackbarMessage): Observable<MdlSnackbarComponent> {\n\n    let optTimeout        = snackbarMessage.timeout || 2750;\n    let closeAfterTimeout = !!snackbarMessage.closeAfterTimeout;\n    let viewContainerRef  = this.dialogOutletService.viewContainerRef;\n\n    if (!viewContainerRef) {\n      throw new Error('You did not provide a ViewContainerRef. ' +\n        'Please see https://github.com/mseemann/angular2-mdl/wiki/How-to-use-the-MdlDialogService');\n    }\n\n    let cRef = viewContainerRef.createComponent(this.cFactory, viewContainerRef.length);\n\n    let mdlSnackbarComponent = <MdlSnackbarComponent> cRef.instance;\n    mdlSnackbarComponent.message = snackbarMessage.message;\n\n    if(this.previousSnack) {\n      let previousSnack = this.previousSnack;\n      let subscription = previousSnack.component.hide()\n        .subscribe(() => {\n          previousSnack.cRef.destroy();\n          subscription.unsubscribe();\n        });\n    }\n\n    this.previousSnack = {\n      component: mdlSnackbarComponent,\n      cRef: cRef\n    };\n\n    if (snackbarMessage.action) {\n      if(closeAfterTimeout) {\n        this.hideAndDestroySnack(mdlSnackbarComponent, cRef, optTimeout)\n      }\n      mdlSnackbarComponent.actionText = snackbarMessage.action.text;\n      mdlSnackbarComponent.onAction = () => {\n        mdlSnackbarComponent.hide().subscribe(() => {\n          cRef.destroy();\n          snackbarMessage.action.handler();\n        });\n      };\n    } else {\n      this.hideAndDestroySnack(mdlSnackbarComponent, cRef, optTimeout)\n    }\n\n    let result: Subject<MdlSnackbarComponent> = new Subject<MdlSnackbarComponent>();\n\n    mdlSnackbarComponent.show().subscribe( () => {\n      result.next(mdlSnackbarComponent);\n      result.complete();\n    });\n\n    return result.asObservable();\n  }\n\n  private hideAndDestroySnack(component, componentRef, timeOut) {\n    setTimeout( () => {\n      component.hide()\n        .subscribe(() => {\n          componentRef.destroy();\n        });\n    }, timeOut);\n  }\n}\n\n@NgModule({\n  imports: [CommonModule, MdlDialogOutletModule.forRoot()],\n  exports: [MdlSnackbarComponent],\n  declarations: [MdlSnackbarComponent],\n  entryComponents: [MdlSnackbarComponent]\n})\nexport class MdlSnackbarModule {\n  public static forRoot(): ModuleWithProviders {\n    return {\n      ngModule: MdlSnackbarModule,\n      providers: [MdlSnackbarService]\n    };\n  }\n}\n"]}