{"version":3,"file":"mdl-dialog-host.component.js","sourceRoot":"","sources":["../../../src/lib/components/dialog/mdl-dialog-host.component.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  Component,\n  ViewEncapsulation,\n  ViewContainerRef,\n  Inject,\n  forwardRef,\n  ViewChild,\n  ElementRef,\n  OnInit,\n  ComponentRef,\n  NgZone, Renderer2\n} from '@angular/core';\n\nimport {\n  MIN_DIALOG_Z_INDEX,\n  MDL_CONFIGUARTION\n} from './mdl-dialog.service';\nimport { IMdlDialogConfiguration, IOpenCloseRect } from './mdl-dialog-configuration';\nimport { MdlButtonComponent } from '../button/mdl-button.component';\nimport { InternalMdlDialogReference } from './internal-dialog-reference';\nimport { Animations } from '../common/animations';\n\nconst enterTransitionDuration = 300;\nconst leaveTransitionDuration = 250;\n\nconst enterTransitionEasingCurve = 'cubic-bezier(0.0, 0.0, 0.2, 1)';\nconst leaveTransitionEasingCurve = 'cubic-bezier(0.0, 0.0, 0.2, 1)';\n\n// @experimental\n@Component({\n  selector: 'mdl-dialog-host-component',\n  host: {\n    '[class.mdl-dialog]': 'true',\n    '[class.open]': 'visible',\n    '[style.zIndex]': 'zIndex',\n  },\n  template: `<div #dialogTarget></div>`,\n  styles: [\n    `\n    mdl-dialog-host-component {\n      width: -moz-fit-content;\n      width: -webkit-fit-content;\n      width: fit-content;\n      height: -moz-fit-content;\n      height: -webkit-fit-content;\n      height: fit-content;\n      padding: 1em;\n      background: white;\n      color: black;\n      opacity: 1;\n      visibility: hidden;\n      display: block;\n      position: fixed;\n      margin: auto;\n      left: 0;\n      right: 0;\n      transition: all;\n      top: 50%;\n      transform: translate(0, -50%);\n    }\n    \n    mdl-dialog-host-component.open {\n      visibility: visible;\n    }\n    \n    `\n  ],\n  encapsulation: ViewEncapsulation.None\n})\nexport class MdlDialogHostComponent implements OnInit {\n\n  @ViewChild('dialogTarget', {read: ViewContainerRef}) public dialogTarget;\n\n  public visible = false;\n\n  private showAnimationStartStyle: {[key: string]: string} = {\n    top: '38%',\n    opacity: '0'\n  };\n\n  private showStyle: {[key: string]: string} = {\n    top: '50%',\n    opacity: '1'\n  };\n\n  private hideAnimationEndStyle: {[key: string]: string} = {\n    top: '63%',\n    opacity: '0'\n  };\n\n  constructor(\n    private ngZone: NgZone,\n    private renderer: Renderer2,\n    private animations: Animations,\n    private elementRef: ElementRef,\n    @Inject(forwardRef( () => MDL_CONFIGUARTION)) private config: IMdlDialogConfiguration,\n    private internalDialogRef: InternalMdlDialogReference){\n  }\n\n  public zIndex: number = MIN_DIALOG_Z_INDEX + 1;\n\n  public show() {\n\n    this.visible = true;\n    // give the dialogs time to draw so that a focus can be set\n    setTimeout( () => {\n      this.internalDialogRef.visible();\n    });\n\n    if (this.isAnimateEnabled()) {\n      if (this.config.openFrom || this.config.closeTo) {\n\n        // transform is modified during anmiation and must be part of each animation keyframe.\n        this.showStyle['transform'] = 'translate(0, -50%) scale(1.0)';\n\n        const targetClientRect = this.elementRef.nativeElement.getBoundingClientRect();\n\n        const openFromRect = this.getClientRect(this.config.openFrom);\n        const closeToRect = this.config.closeTo ? this.getClientRect(this.config.closeTo) : openFromRect;\n\n        const centerTarget = this.getCenterInScreen(targetClientRect);\n        const centerFrom = this.getCenterInScreen(openFromRect);\n        const centerTo = this.getCenterInScreen(closeToRect);\n\n        const translationFrom = {\n          x: Math.round(centerFrom.cx - centerTarget.cx),\n          y: Math.round(centerFrom.cy - centerTarget.cy),\n          scaleX: Math.round(100 * Math.min(0.25, openFromRect.width / targetClientRect.width)) / 100,\n          scaleY: Math.round(100 * Math.min(0.25, openFromRect.height / targetClientRect.height)) / 100\n        };\n\n        this.showAnimationStartStyle = {\n          top: `${targetClientRect.top}px`,\n          opacity: '0',\n          transform: `translate(${translationFrom.x}px, ${translationFrom.y}px) scale(${translationFrom.scaleX}, ${translationFrom.scaleY})`\n        };\n\n        const translationTo = {\n          x: Math.round(centerTo.cx - centerTarget.cx),\n          y: Math.round(centerTo.cy - centerTarget.cy),\n          scaleX: Math.round(100 * Math.min(0.25, closeToRect.width / targetClientRect.width)) / 100,\n          scaleY: Math.round(100 * Math.min(0.25, closeToRect.height / targetClientRect.height)) / 100\n        };\n\n        this.hideAnimationEndStyle  = {\n          top: `${targetClientRect.top}px`,\n          opacity: '0',\n          transform: `translate(${translationTo.x}px, ${translationTo.y}px) scale(${translationTo.scaleX}, ${translationTo.scaleY})`\n        }\n      }\n\n\n      let animation: any = this.animations.animate(\n        this.elementRef.nativeElement,\n        [\n          this.showAnimationStartStyle,\n          this.showStyle\n        ],\n        this.config.enterTransitionDuration || enterTransitionDuration,\n        this.config.enterTransitionEasingCurve || enterTransitionEasingCurve);\n\n      animation.play();\n\n    }\n  }\n\n  public hide(selfComponentRef: ComponentRef<MdlDialogHostComponent>){\n    if (this.isAnimateEnabled()){\n\n      let animation: any = this.animations.animate(\n        this.elementRef.nativeElement,\n        [\n          this.showStyle,\n          this.hideAnimationEndStyle\n        ],\n        this.config.leaveTransitionDuration || leaveTransitionDuration,\n        this.config.leaveTransitionEasingCurve || leaveTransitionEasingCurve);\n\n      animation.onDone( () => {\n        selfComponentRef.destroy();\n      });\n\n      animation.play();\n\n    } else {\n      selfComponentRef.destroy();\n    }\n  }\n\n  public ngOnInit() {\n    this.applyStyle(this.config.styles);\n    this.applyClasses(this.config.classes ? this.config.classes : '');\n  }\n\n  private applyStyle(styles: {[key: string]: string}) {\n    if (styles) {\n      for (let style in styles){\n        this.renderer.setStyle(this.elementRef.nativeElement, style, styles[style]);\n      }\n    }\n  }\n\n  private applyClasses(classes: string){\n    classes.split(' ').filter( (cssClass) => { return !!cssClass }).forEach( ( cssClass )=> {\n      this.renderer.addClass(this.elementRef.nativeElement, cssClass);\n    });\n  }\n\n  private isAnimateEnabled() {\n   // not present?  assume it is true.\n    if (typeof this.config.animate === 'undefined'){\n      return true;\n    }\n    return this.config.animate;\n  }\n\n  private getClientRect(input: MdlButtonComponent | MouseEvent | IOpenCloseRect): IOpenCloseRect {\n\n    if(input instanceof MdlButtonComponent){\n\n      const elRef = (input as MdlButtonComponent).elementRef;\n      const rect: ClientRect = elRef.nativeElement.getBoundingClientRect();\n      return this.createOpenCloseRect(rect);\n\n    } else if (input instanceof MouseEvent) {\n\n      const evt: MouseEvent = input as MouseEvent;\n      // just to make it possible to test this code with a fake event - target is\n      // readonly and con not be mutated.\n      const htmlElement = (evt.target || evt['testtarget']) as HTMLElement;\n      const rect: ClientRect = htmlElement.getBoundingClientRect();\n      return this.createOpenCloseRect(rect);\n\n    }\n    return input as IOpenCloseRect;\n  }\n\n  private createOpenCloseRect(rect: ClientRect) : IOpenCloseRect {\n    return {\n      height: rect.top - rect.bottom,\n      left: rect.left,\n      top: rect.top,\n      width: rect.right-rect.left\n    }\n  }\n\n  private getCenterInScreen(rect: IOpenCloseRect) {\n    return {\n      cx: Math.round(rect.left + (rect.width / 2)),\n      cy: Math.round(rect.top + (rect.height / 2))\n    };\n  }\n\n\n}\n"]}